#sidebar: p {{sidebar_text}}

.logos
  img(src="file:///{{ egf_logo_url }}" style="height:50px; width: auto")
  img(src="file:///{{ epijinn_logo_url }}" style="height:50px; width: auto; float:right")

hr
h1 Methylation analysis report
hr

p.
  This document reports the sequencing results of the
  <b>{{ bedmethylitemgroup.parameter_dict.projectname }}</b> project.
  There are <b>{{ bedmethylitemgroup.number_of_samples }}</b> samples in this report.
  Each chapter details the results for one sample (plasmid), and the chapter sections
  report on each methylation subtype (modified nucleotide) × methylation pattern
  (methylase enzyme recognition site) analysis. The following methylase (pattern)
  was used in this analysis: <b>{{ bedmethylitemgroup.parameter_dict.methylases }}</b>.

  Please see the Appendix on the last page for further explanation of the report.


//- div(style="margin-top:1cm; margin-bottom:1cm;")

//- <div style = "display:block; clear:both; page-break-after:always;"></div>



each bedmethylitem in bedmethylitemgroup.bedmethylitems

  h2 {{ bedmethylitem.sample }} &nbsp;&nbsp; | &nbsp;&nbsp; {{ bedmethylitem.id }}
  hr

  p.
    Plot of the sequence:

  img#diff-figure(src="{{ bedmethylitem.bedmethylitem_figure_data }}")

  //- <div style = "display:block; clear:both; page-break-after:always;"></div>
  


  each bedresult in bedmethylitem.results

    div(style="margin-top:1cm; margin-bottom:1cm;")

    hr
    h3 {{ bedresult.mod_abbreviation }} ({{ bedresult.modification }}) &nbsp;&nbsp; × &nbsp;&nbsp; {{ bedmethylitemgroup.parameter_dict.methylases }}
    hr

    //- if bedresult.img_created

    img#diff-figure(src="{{ bedresult.figure_data }}")

    //- else
    //-   p The pattern was found more than {{ bedresult.feature_cutoff }} times, therefore the sequence plot was not created.

    p Bedmethyl table:

    {{ bedresult.bed_pdf }}

  //- div(style="display:block; clear:both; page-break-after:always")

<div style = "display:block; clear:both; page-break-after:always;"></div>


h2 Appendix

p.
  The report was generated by <a href="https://edinburgh-genome-foundry.github.io/EpiJinn/">EpiJinn</a>,
  a software published by the Edinburgh Genome Foundry (EGF).
  EpiJinn is part of the <a href="https://edinburgh-genome-foundry.github.io/">EGF Codons</a>
  engineering biology software suite for DNA design, manufacturing and validation.

p.
  Each chapter details the results for one plasmid, and the chapter sections
  report on each methylation subtype (modified nucleotide) ~ methylation pattern
  (methylase enzyme recognition site) analysis. The sections begin with a sequence plot
  which displays the locations of the pattern (modified nucleotide) in the sequence.
  If the pattern is present a large number of times, then this plot is not displayed.
  A simplified bedMethyl table is also displayed, which shows the position
  (using a zero-based index) and values for the modified nucleotides.
  A methylation status is also determined (`STATUS` column), based on user-specified thresholds. 
  The table entries and the sequence plot annotations are coloured based on this status.
  The columns of the table are:
  <ul>
    <li>LOC: Zero-based position of modified nucleotide</li>
    <li>Strand: DNA strand (+/-)</li>
    <li>COV: coverage = MOD + STD + OTH</li>
    <li>% mod: % = MOD / COV * 100</li>
    <li>MOD: modified count</li>
    <li>STD: canonical base count</li>
    <li>OTH: count for other modifications</li>
    <li>del: number of reads with deletion at this position</li>
    <li>fail: number of calls below threshold</li>
    <li>diff: number of reads with base other than canonical at this position</li>
    <li>nocall: number of reads without modification call</li>
    <li>STATUS: methylated / undetermined / unmethylated (1/U/0)</li>
  </ul>

p.
  Modified nucleotide summary table:

table(style='width:50%', border='1')
  tr
    th Code
    th Abbreviation
    th Name
    th ChEBI
  tr
    td m
    td 5mC
    td 5-Methylcytosine
    td 27551
  tr
    td h
    td 5hmC
    td 5-Hydroxymethylcytosine
    td 76792
  tr
    td 21839
    td 4mC
    td 4-Methylcytosine
    td 21839
  tr
    td a
    td 6mA
    td 6-Methyladenine
    td 28871


style.
  .green {
    color: #86bf86
  }
  .grey {
    color: #a9a9a9
  }
  .red {
    color: #fd5a31
  }
  .yellow {
    color: #f7b500
  }
